name: Cron Examples

on:
  schedule:
    # 可以定义多个 cron 表达式
    # 每小时执行
    # - cron: '0 * * * *'
    
    # 每 6 小时执行（UTC 00:00, 06:00, 12:00, 18:00）
    - cron: '0 */6 * * *'
    
    # 每周一 UTC 00:00（北京时间周一 08:00）
    # - cron: '0 0 * * 1'
  
  workflow_dispatch:

jobs:
  # 示例 1: 简单任务
  simple-task:
    runs-on: ubuntu-latest
    steps:
      - name: Echo time
        run: |
          echo "当前 UTC 时间: $(date -u '+%Y-%m-%d %H:%M:%S')"
          echo "当前北京时间: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S')"

  # 示例 2: 使用 Python 脚本
  python-task:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install requests
      
      - name: Run Python script
        run: |
          python -c "
          import datetime
          print(f'Python 任务执行时间: {datetime.datetime.now()}')
          # 在这里添加你的 Python 逻辑
          "

  # 示例 3: 使用 Node.js 脚本
  node-task:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Run Node.js script
        run: |
          node -e "
          console.log('Node.js 任务执行时间:', new Date().toISOString());
          // 在这里添加你的 Node.js 逻辑
          "

  # 示例 4: 带条件的任务
  conditional-task:
    runs-on: ubuntu-latest
    steps:
      - name: Check day of week
        id: check-day
        run: |
          DAY=$(date -u +%u)  # 1=周一, 7=周日
          echo "day=$DAY" >> $GITHUB_OUTPUT
          if [ "$DAY" -le 5 ]; then
            echo "is_weekday=true" >> $GITHUB_OUTPUT
          else
            echo "is_weekday=false" >> $GITHUB_OUTPUT
          fi
      
      - name: Weekday only task
        if: steps.check-day.outputs.is_weekday == 'true'
        run: echo "这是工作日任务"
      
      - name: Weekend only task
        if: steps.check-day.outputs.is_weekday == 'false'
        run: echo "这是周末任务"

  # 示例 5: 使用 Secrets
  secret-task:
    runs-on: ubuntu-latest
    # 如果需要使用 secrets，取消下面的注释
    # env:
    #   API_KEY: ${{ secrets.API_KEY }}
    steps:
      - name: Task with secrets
        run: |
          echo "如需使用 secrets，请在仓库设置中添加"
          # 使用示例：
          # curl -H "Authorization: Bearer $API_KEY" https://api.example.com

  # 示例 6: 带重试的任务
  retry-task:
    runs-on: ubuntu-latest
    steps:
      - name: Task with retry
        uses: nick-fields/retry@v2
        with:
          timeout_minutes: 5
          max_attempts: 3
          retry_wait_seconds: 30
          command: |
            echo "这个任务会在失败时自动重试"
            # 你的命令

  # 示例 7: PushPlus 微信推送通知
  pushplus-notify-task:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: pip install requests

      - name: Send PushPlus notification
        env:
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
        run: python scripts/pushplus_notify.py
        # 需要在仓库 Settings > Secrets 中添加 PUSHPLUS_TOKEN
        # 在 https://www.pushplus.plus/ 注册获取 token
