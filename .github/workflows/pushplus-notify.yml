name: PushPlus å®šæ—¶é€šçŸ¥

on:
  schedule:
    # ===== æŒ‰éœ€ä¿®æ”¹å®šæ—¶è§„åˆ™ =====
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 08:00ï¼ˆUTC 00:00ï¼‰å‘é€æ—©é—´é€šçŸ¥
    - cron: '0 0 * * *'
    
    # æ¯å¤©åŒ—äº¬æ—¶é—´ 20:00ï¼ˆUTC 12:00ï¼‰å‘é€æ™šé—´é€šçŸ¥
    # - cron: '0 12 * * *'
    
    # æ¯å‘¨ä¸€åŒ—äº¬æ—¶é—´ 09:00ï¼ˆUTC 01:00ï¼‰å‘é€å‘¨æŠ¥æé†’
    # - cron: '0 1 * * 1'

  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆæ–¹ä¾¿æµ‹è¯•ï¼‰
  workflow_dispatch:
    inputs:
      title:
        description: 'é€šçŸ¥æ ‡é¢˜ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤æ¯æ—¥æŠ¥å‘Šï¼‰'
        required: false
        default: ''
      content:
        description: 'é€šçŸ¥å†…å®¹ï¼ˆç•™ç©ºåˆ™ä½¿ç”¨é»˜è®¤æ¯æ—¥æŠ¥å‘Šï¼‰'
        required: false
        default: ''
      template:
        description: 'æ¶ˆæ¯æ¨¡æ¿ç±»åž‹'
        required: false
        default: 'markdown'
        type: choice
        options:
          - markdown
          - html
          - txt
          - json

jobs:
  send-notification:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Send PushPlus notification
        env:
          PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
          NOTIFY_TITLE: ${{ github.event.inputs.title }}
          NOTIFY_CONTENT: ${{ github.event.inputs.content }}
          NOTIFY_TEMPLATE: ${{ github.event.inputs.template || 'markdown' }}
        run: python scripts/pushplus_notify.py
      
      - name: Summary
        if: always()
        run: |
          echo "### ðŸ“¨ PushPlus é€šçŸ¥ä»»åŠ¡" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **æ‰§è¡Œæ—¶é—´**: $(TZ='Asia/Shanghai' date '+%Y-%m-%d %H:%M:%S') (åŒ—äº¬æ—¶é—´)" >> $GITHUB_STEP_SUMMARY
          echo "- **è§¦å‘æ–¹å¼**: ${{ github.event_name }}" >> $GITHUB_STEP_SUMMARY
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "- **è‡ªå®šä¹‰æ ‡é¢˜**: ${{ github.event.inputs.title || '(é»˜è®¤æ¯æ—¥æŠ¥å‘Š)' }}" >> $GITHUB_STEP_SUMMARY
          fi
